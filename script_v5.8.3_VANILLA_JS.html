<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Satellite Sensor Explorer v5.8.3</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --color-bg: #0f172a;
            --color-surface: #1e293b;
            --color-border: #334155;
            --color-text: #f1f5f9;
            --color-text-secondary: #cbd5e1;
            --color-primary: #38bdf8;
            --color-primary-hover: #0284c7;
            --color-success: #10b981;
            --color-accent: #a78bfa;
            --color-error: #ef4444;
            --color-warning: #f59e0b;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text);
            line-height: 1.6;
            overflow: hidden;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        .sidebar {
            width: 300px;
            background-color: var(--color-surface);
            border-right: 1px solid var(--color-border);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .header {
            padding: 20px;
            border-bottom: 1px solid var(--color-border);
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
        }

        .header h1 {
            font-size: 18px;
            margin-bottom: 10px;
            color: var(--color-primary);
        }

        .header p {
            font-size: 12px;
            color: var(--color-text-secondary);
        }

        .version-badge {
            display: inline-block;
            background: rgba(56, 189, 248, 0.15);
            color: var(--color-primary);
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
            margin-top: 8px;
        }

        .action-toolbar {
            padding: 12px;
            border-bottom: 1px solid var(--color-border);
            display: flex;
            gap: 8px;
        }

        .btn {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: var(--color-primary);
            color: #0f172a;
        }

        .btn-primary:hover {
            background: var(--color-primary-hover);
            transform: translateY(-1px);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-small {
            padding: 4px 8px;
            font-size: 11px;
        }

        .btn-danger {
            background: var(--color-error);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--color-text);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .search-box {
            padding: 15px;
            border-bottom: 1px solid var(--color-border);
        }

        .search-box input {
            width: 100%;
            padding: 8px 12px;
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--color-border);
            border-radius: 6px;
            color: var(--color-text);
            font-size: 13px;
        }

        .search-box input::placeholder {
            color: var(--color-text-secondary);
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--color-primary);
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid var(--color-border);
        }

        .tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            background-color: transparent;
            border: none;
            color: var(--color-text-secondary);
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
        }

        .tab:hover {
            color: var(--color-text);
            background-color: rgba(255, 255, 255, 0.05);
        }

        .tab.active {
            color: var(--color-primary);
            border-bottom-color: var(--color-primary);
            background-color: rgba(56, 189, 248, 0.1);
        }

        .sort-controls {
            padding: 10px 12px;
            border-bottom: 1px solid var(--color-border);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
        }

        .sort-controls label {
            color: var(--color-text-secondary);
        }

        .sort-controls select {
            flex: 1;
            padding: 6px 10px;
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--color-border);
            border-radius: 4px;
            color: var(--color-text);
            font-size: 12px;
            cursor: pointer;
        }

        .sort-controls select:focus {
            outline: none;
            border-color: var(--color-primary);
        }

        .list-container {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .list-item {
            padding: 12px;
            margin-bottom: 8px;
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--color-border);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
            font-size: 13px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .list-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
            border-left-color: var(--color-primary);
        }

        .list-item.active {
            background-color: rgba(56, 189, 248, 0.15);
            border-left-color: var(--color-primary);
            border-color: var(--color-primary);
        }

        .list-item-content {
            flex: 1;
        }

        .list-item-actions {
            display: flex;
            gap: 4px;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .list-item:hover .list-item-actions {
            opacity: 1;
        }

        .list-item-title {
            font-weight: 500;
            margin-bottom: 4px;
        }

        .list-item-meta {
            font-size: 11px;
            color: var(--color-text-secondary);
        }

        .sensor-count-badge {
            display: inline-block;
            background-color: rgba(167, 139, 250, 0.2);
            color: var(--color-accent);
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 4px;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .top-section {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        .details-panel {
            flex: 1;
            padding: 30px;
            background-color: var(--color-bg);
            overflow-y: auto;
            border-right: 1px solid var(--color-border);
        }

        .details-panel h2 {
            color: var(--color-primary);
            margin-bottom: 20px;
            font-size: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .details-panel h2 .icon {
            font-size: 28px;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .detail-item {
            background-color: var(--color-surface);
            padding: 15px;
            border-radius: 6px;
            border: 1px solid var(--color-border);
        }

        .detail-label {
            font-size: 12px;
            color: var(--color-text-secondary);
            text-transform: uppercase;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .detail-value {
            font-size: 14px;
            color: var(--color-text);
            font-weight: 500;
        }

        .section-title {
            color: var(--color-accent);
            margin-top: 25px;
            margin-bottom: 15px;
            font-size: 16px;
            font-weight: 600;
            text-transform: uppercase;
            border-bottom: 2px solid var(--color-accent);
            padding-bottom: 10px;
        }

        .relationships-panel {
            width: 280px;
            background-color: var(--color-surface);
            border-left: 1px solid var(--color-border);
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .relationships-panel h3 {
            color: var(--color-primary);
            margin-bottom: 15px;
            font-size: 16px;
            flex-shrink: 0;
        }

        .relationships-count {
            font-size: 11px;
            color: var(--color-text-secondary);
            margin-bottom: 10px;
        }

        .relationship-item {
            background-color: rgba(255, 255, 255, 0.05);
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 6px;
            border-left: 3px solid var(--color-success);
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s ease;
        }

        .relationship-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        .relationship-item.sensor-type {
            border-left-color: var(--color-accent);
        }

        .rel-title {
            font-weight: 500;
            margin-bottom: 3px;
        }

        .rel-type {
            font-size: 11px;
            color: var(--color-text-secondary);
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--color-text-secondary);
        }

        .empty-state .icon {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .no-data {
            padding: 20px;
            text-align: center;
            color: var(--color-text-secondary);
            font-size: 13px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: var(--color-surface);
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--color-border);
        }

        .modal-header h3 {
            margin: 0;
            color: var(--color-primary);
            font-size: 20px;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: var(--color-text-secondary);
            line-height: 1;
        }

        .modal-close:hover {
            color: var(--color-text);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--color-text);
            font-size: 13px;
        }

        .form-group.required label::after {
            content: ' *';
            color: var(--color-error);
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--color-border);
            border-radius: 6px;
            font-size: 13px;
            font-family: inherit;
            color: var(--color-text);
            background: rgba(255, 255, 255, 0.05);
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .validation-error {
            color: var(--color-error);
            font-size: 12px;
            margin-top: 4px;
            display: block;
            min-height: 16px;
        }

        .form-actions {
            display: flex;
            gap: 12px;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid var(--color-border);
        }

        .form-actions button {
            flex: 1;
        }

        .alert {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 6px;
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            color: var(--color-text);
            z-index: 9999;
            animation: slideIn 0.3s ease;
            max-width: 400px;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .alert-success {
            border-color: var(--color-success);
            color: var(--color-success);
        }

        .alert-error {
            border-color: var(--color-error);
            color: var(--color-error);
        }

        .alert-info {
            border-color: var(--color-primary);
            color: var(--color-primary);
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(56, 189, 248, 0.3);
            border-top-color: var(--color-primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--color-border);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--color-primary);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- SIDEBAR -->
        <div class="sidebar">
            <div class="header">
                <h1>üõ∞Ô∏è Explorer</h1>
                <p id="connectionStatus">Loading...</p>
                <div class="version-badge">v5.8.3 VANILLA</div>
            </div>
            <div class="action-toolbar" id="actionToolbar">
                <button type="button" class="btn btn-primary" id="addBtn" style="flex: 1;">+Add</button>
                <button type="button" class="btn btn-secondary btn-small" id="importBtn" title="Import CSV">üì•</button>
                <button type="button" class="btn btn-secondary btn-small" id="linkBtn" title="Link Sat-Sensor">üîó</button>
            </div>
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Search...">
            </div>
            <div class="tabs">
                <button type="button" class="tab active" data-tab="satellites">Satellites</button>
                <button type="button" class="tab" data-tab="sensors">Sensors</button>
            </div>
            <div class="sort-controls">
                <label>Sort:</label>
                <select id="sortSelect">
                    <!-- Populated by JS -->
                </select>
            </div>
            <div class="list-container" id="listContainer">
                <div class="empty-state">
                    <div class="loading"></div>
                    <p style="margin-top: 10px;">Loading data...</p>
                </div>
            </div>
        </div>

        <!-- MAIN CONTENT -->
        <div class="main-content">
            <div class="top-section">
                <!-- DETAILS PANEL -->
                <div class="details-panel" id="detailsPanel">
                    <div class="empty-state">
                        <div class="icon">üìä</div>
                        <p>Select a satellite or sensor to view details</p>
                    </div>
                </div>
                <!-- RELATIONSHIPS PANEL -->
                <div class="relationships-panel" id="relationshipsPanel">
                    <h3>Relationships</h3>
                    <div id="relationshipsList" class="no-data">No selection</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ADD/EDIT SATELLITE MODAL -->
    <div id="satelliteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="satelliteModalTitle">Add Satellite</h3>
                <button type="button" class="modal-close" id="modalCloseBtn">&times;</button>
            </div>
            <form id="satelliteForm">
                <div class="form-group required">
                    <label for="sat-name">Satellite Name</label>
                    <input type="text" id="sat-name" placeholder="Enter satellite name">
                    <span class="validation-error" id="error-sat-name"></span>
                </div>
                <div class="form-group required">
                    <label for="sat-norad">NORAD ID</label>
                    <input type="text" id="sat-norad" placeholder="Enter NORAD ID">
                    <span class="validation-error" id="error-sat-norad"></span>
                </div>
                <div class="form-group">
                    <label for="sat-cospar">COSPAR ID</label>
                    <input type="text" id="sat-cospar" placeholder="e.g., 2013-008A">
                </div>
                <div class="form-group">
                    <label for="sat-mission">Mission Type</label>
                    <input type="text" id="sat-mission" placeholder="e.g., Earth Observation">
                </div>
                <div class="form-group">
                    <label for="sat-status">Status</label>
                    <select id="sat-status">
                        <option value="Operational">Operational</option>
                        <option value="Non-operational">Non-operational</option>
                        <option value="Partially operational">Partially operational</option>
                        <option value="Unknown">Unknown</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="sat-orbit">Orbit Type</label>
                    <select id="sat-orbit">
                        <option value="">-- Select --</option>
                        <option value="LEO">LEO</option>
                        <option value="MEO">MEO</option>
                        <option value="GEO">GEO</option>
                        <option value="SSO">SSO</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="sat-launch">Launch Date</label>
                    <input type="date" id="sat-launch">
                </div>
                <div class="form-group">
                    <label for="sat-sensors">Sensor Names (comma-separated)</label>
                    <textarea id="sat-sensors" placeholder="e.g., AIRS, AMSR-E"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-primary" id="saveSatelliteBtn">Save</button>
                    <button type="button" class="btn btn-secondary" id="cancelSatelliteBtn">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <div id="alertContainer"></div>

    <script>
        /**
         * SATELLITE SENSOR EXPLORER v5.8.3 - VANILLA JS (ISOLATED)
         * Pure vanilla JavaScript - NO jQuery dependency
         * IIFE wrapper to prevent global namespace pollution
         */

        (function() {
            'use strict';

            // ============================================================
            // CONFIGURATION
            // ============================================================

            const config = {
                satelliteList: 'Satellite_Fixed',
                sensorList: 'Sensor',
                missionList: 'Mission',
                junctionList: 'Satellite_Sensor_Mission',
                linkList: 'satellite_sensor',
                inSharePoint: typeof _spPageContextInfo !== 'undefined' && _spPageContextInfo?.webAbsoluteUrl,
                siteUrl: typeof _spPageContextInfo !== 'undefined' ? _spPageContextInfo.webAbsoluteUrl : '',
                apiTimeout: 30000
            };

            // ============================================================
            // STATE
            // ============================================================

            const data = {
                satellites: [],
                sensors: [],
                satellite_sensor_links: []
            };

            let currentTab = 'satellites';
            let selectedItem = null;
            let searchTerm = '';
            let currentSort = { column: 'name', direction: 'asc' };
            let editingId = null;
            let isLoading = false;

            // ============================================================
            // DOM UTILITIES (scoped to IIFE)
            // ============================================================

            const DOMUtil = {
                query: (selector) => document.querySelector(selector),
                queryAll: (selector) => document.querySelectorAll(selector),
                byId: (id) => document.getElementById(id),
                create: (tag, attrs = {}) => {
                    const el = document.createElement(tag);
                    Object.entries(attrs).forEach(([key, value]) => {
                        if (key === 'class') {
                            el.className = value;
                        } else if (key === 'html') {
                            el.innerHTML = value;
                        } else if (key === 'text') {
                            el.textContent = value;
                        } else {
                            el.setAttribute(key, value);
                        }
                    });
                    return el;
                },
                on: (el, event, handler) => {
                    if (el && typeof el.addEventListener === 'function') {
                        el.addEventListener(event, handler);
                    }
                },
                off: (el, event, handler) => {
                    if (el && typeof el.removeEventListener === 'function') {
                        el.removeEventListener(event, handler);
                    }
                },
                addClass: (el, className) => el && el.classList && el.classList.add(className),
                removeClass: (el, className) => el && el.classList && el.classList.remove(className),
                toggleClass: (el, className) => el && el.classList && el.classList.toggle(className),
                hasClass: (el, className) => el && el.classList && el.classList.contains(className),
                setAttr: (el, attr, value) => el && el.setAttribute(attr, value),
                getAttr: (el, attr) => el && el.getAttribute(attr),
                removeAttr: (el, attr) => el && el.removeAttribute(attr),
                setStyle: (el, styles) => Object.assign(el.style, styles),
                show: (el) => el && (el.style.display = ''),
                hide: (el) => el && (el.style.display = 'none'),
                empty: (el) => el && (el.innerHTML = '')
            };

            // ============================================================
            // POLYFILL: AbortSignal.timeout
            // ============================================================

            if (!AbortSignal.timeout) {
                AbortSignal.timeout = function(ms) {
                    const controller = new AbortController();
                    setTimeout(() => controller.abort(), ms);
                    return controller.signal;
                };
            }

            // ============================================================
            // INITIALIZATION
            // ============================================================

            document.addEventListener('DOMContentLoaded', async () => {
                console.log('üöÄ Initializing Satellite Sensor Explorer v5.8.3 (Vanilla JS - Isolated)');
                console.log('SharePoint Mode:', config.inSharePoint ? 'YES' : 'NO');

                const statusEl = DOMUtil.byId('connectionStatus');

                if (config.inSharePoint) {
                    if (statusEl) {
                        statusEl.textContent = 'SharePoint Connected';
                        DOMUtil.setStyle(statusEl, { color: 'var(--color-success)' });
                    }
                } else {
                    if (statusEl) {
                        statusEl.textContent = 'Local Mode';
                        DOMUtil.setStyle(statusEl, { color: 'var(--color-text-secondary)' });
                    }
                }

                try {
                    if (config.inSharePoint && config.siteUrl) {
                        await loadSatellites();
                        await loadSensors();
                        await loadSatelliteSensorLinks();
                    } else {
                        // Sample data for local mode
                        data.satellites = [
                            {
                                ID: 1,
                                norad_id: 27424,
                                name: 'AQUA',
                                cospar_id: '2002-022A',
                                status: 'Operational',
                                mission: 'METOC',
                                orbit_type: 'SSO',
                                launch_date: '2002-05-04',
                                constellation_id: '',
                                sensor_names: 'AIRS, AMSR-E'
                            },
                            {
                                ID: 2,
                                norad_id: 25994,
                                name: 'TERRA',
                                cospar_id: '1999-071A',
                                status: 'Operational',
                                mission: 'METOC',
                                orbit_type: 'SSO',
                                launch_date: '1999-12-18',
                                constellation_id: '',
                                sensor_names: 'ASTER'
                            }
                        ];

                        data.sensors = [
                            {
                                sensor_id: 11,
                                name: 'AIRS',
                                type: 'Infrared',
                                description: 'Atmospheric Infrared Sounder',
                                bands: 7,
                                resolution_min: 13500,
                                resolution_max: 13500,
                                swath_min: 'N/A',
                                swath_max: 'N/A'
                            },
                            {
                                sensor_id: 26,
                                name: 'AMSR-E',
                                type: 'Microwave',
                                description: 'Advanced Microwave Scanning Radiometer',
                                bands: 6,
                                resolution_min: 5000,
                                resolution_max: 56000,
                                swath_min: 1450,
                                swath_max: 1450
                            },
                            {
                                sensor_id: 33,
                                name: 'ASTER',
                                type: 'Multispectral',
                                description: 'Advanced Spaceborne Thermal Emission',
                                bands: 14,
                                resolution_min: 15,
                                resolution_max: 90,
                                swath_min: 60,
                                swath_max: 60
                            }
                        ];

                        buildSatelliteSensorLinksFromNames();
                    }

                    attachEventListeners();
                    updateSortOptions();
                    renderList();

                    console.log('‚úÖ Initialization complete');
                } catch (error) {
                    console.error('‚ùå Initialization error:', error);
                    showAlert('Failed to initialize: ' + error.message, 'error');
                }
            });

            // ============================================================
            // SHAREPOINT API FUNCTIONS
            // ============================================================

            async function loadSatellites() {
                if (!config.inSharePoint || !config.siteUrl) {
                    console.log('Not in SharePoint mode, skipping satellite load');
                    return;
                }

                try {
                    const url = config.siteUrl +
                        `/_api/web/lists/getbytitle('${config.satelliteList}')/items?$select=ID,Title,NORAD_ID,COSPAR_ID,Mission_Type,Status,Orbit_Type,Launch_Date,Constellation_ID,Sensor_Names&$top=5000`;

                    const response = await fetch(url, {
                        method: 'GET',
                        headers: { 'Accept': 'application/json;odata=verbose' },
                        credentials: 'include',
                        signal: AbortSignal.timeout(config.apiTimeout)
                    });

                    if (!response.ok) throw new Error('HTTP ' + response.status);

                    const result = await response.json();

                    data.satellites = (result?.d?.results ?? []).map(item => ({
                        ID: item.ID,
                        norad_id: item.NORAD_ID || item.ID,
                        name: item.Title || 'Unknown',
                        cospar_id: item.COSPAR_ID || '',
                        status: item.Status || 'Unknown',
                        mission: item.Mission_Type || '',
                        orbit_type: item.Orbit_Type || '',
                        launch_date: item.Launch_Date ? new Date(item.Launch_Date).toISOString().split('T')[0] : '',
                        constellation_id: item.Constellation_ID || '',
                        sensor_names: item.Sensor_Names || ''
                    }));

                    console.log(`‚úÖ Loaded ${data.satellites.length} satellites from SharePoint`);
                } catch (error) {
                    console.error('Error loading satellites:', error);
                    showAlert('Error loading satellites: ' + error.message, 'error');
                    throw error;
                }
            }

            async function loadSensors() {
                if (!config.inSharePoint || !config.siteUrl) {
                    data.sensors = [];
                    return;
                }

                try {
                    const url = config.siteUrl +
                        `/_api/web/lists/getbytitle('${config.sensorList}')/items?$select=ID,Title,Sensor_Type,Description,N_of_Bands,Resolution_Min_m,Resolution_Max_m,Swath_Min_km,Swath_Max_km,Satellite_Names&$top=5000`;

                    const response = await fetch(url, {
                        method: 'GET',
                        headers: { 'Accept': 'application/json;odata=verbose' },
                        credentials: 'include',
                        signal: AbortSignal.timeout(config.apiTimeout)
                    });

                    if (!response.ok) throw new Error('HTTP ' + response.status);

                    const result = await response.json();

                    data.sensors = (result?.d?.results ?? []).map(item => ({
                        sensor_id: item.ID,
                        name: item.Title || 'Unknown',
                        type: item.Sensor_Type || '',
                        description: item.Description || '',
                        bands: item.N_of_Bands || '',
                        resolution_min: item.Resolution_Min_m || 'N/A',
                        resolution_max: item.Resolution_Max_m || 'N/A',
                        swath_min: item.Swath_Min_km || 'N/A',
                        swath_max: item.Swath_Max_km || 'N/A',
                        satellite_names: item.Satellite_Names || ''
                    }));

                    console.log(`‚úÖ Loaded ${data.sensors.length} sensors from SharePoint`);
                } catch (error) {
                    console.error('Error loading sensors:', error);
                    data.sensors = [];
                    throw error;
                }
            }

            async function loadSatelliteSensorLinks() {
                if (!config.inSharePoint || !config.siteUrl) {
                    buildSatelliteSensorLinksFromNames();
                    return;
                }

                try {
                    const url = config.siteUrl +
                        `/_api/web/lists/getbytitle('${config.linkList}')/items?$select=ID,norad_id,sensor_id&$top=5000`;

                    const response = await fetch(url, {
                        method: 'GET',
                        headers: { 'Accept': 'application/json;odata=verbose' },
                        credentials: 'include',
                        signal: AbortSignal.timeout(config.apiTimeout)
                    });

                    if (response.ok) {
                        const result = await response.json();
                        data.satellite_sensor_links = (result?.d?.results ?? []).map(item => ({
                            norad_id: item.norad_id,
                            sensor_id: item.sensor_id
                        }));

                        console.log(`‚úÖ Loaded ${data.satellite_sensor_links.length} links from satellite_sensor list`);
                    } else {
                        throw new Error('List not found, using fallback');
                    }
                } catch (error) {
                    console.warn('satellite_sensor list not found, falling back to Sensor_Names parsing');
                    buildSatelliteSensorLinksFromNames();
                }
            }

            function buildSatelliteSensorLinksFromNames() {
                data.satellite_sensor_links = [];

                data.satellites.forEach(sat => {
                    if (!sat.sensor_names) return;

                    const sensorNames = sat.sensor_names
                        .split(',')
                        .map(s => s.trim().toLowerCase())
                        .filter(s => s);

                    sensorNames.forEach(sensorName => {
                        const matchedSensor = data.sensors.find(sensor =>
                            sensor.name.toLowerCase().trim() === sensorName ||
                            sensor.name.toLowerCase().includes(sensorName) ||
                            sensorName.includes(sensor.name.toLowerCase())
                        );

                        if (matchedSensor) {
                            const exists = data.satellite_sensor_links.some(link =>
                                link.norad_id === sat.norad_id && link.sensor_id === matchedSensor.sensor_id
                            );

                            if (!exists) {
                                data.satellite_sensor_links.push({
                                    norad_id: sat.norad_id,
                                    sensor_id: matchedSensor.sensor_id
                                });
                            }
                        }
                    });
                });

                console.log(`‚úÖ Built ${data.satellite_sensor_links.length} links from Sensor_Names field`);
            }

            // ============================================================
            // EVENT LISTENERS
            // ============================================================

            function attachEventListeners() {
                // Tab switching
                DOMUtil.queryAll('.tab').forEach(tab => {
                    DOMUtil.on(tab, 'click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        DOMUtil.queryAll('.tab').forEach(t => DOMUtil.removeClass(t, 'active'));
                        DOMUtil.addClass(tab, 'active');
                        currentTab = tab.dataset.tab;
                        selectedItem = null;
                        updateSortOptions();
                        renderList();
                        clearDetails();
                        return false;
                    });
                });

                // Search
                const searchInput = DOMUtil.byId('searchInput');
                if (searchInput) {
                    DOMUtil.on(searchInput, 'input', (e) => {
                        searchTerm = e.target.value.toLowerCase();
                        renderList();
                    });
                }

                // Sort
                const sortSelect = DOMUtil.byId('sortSelect');
                if (sortSelect) {
                    DOMUtil.on(sortSelect, 'change', (e) => {
                        const [column, direction] = e.target.value.split('-');
                        currentSort = { column, direction };
                        renderList();
                    });
                }

                // Add button
                const addBtn = DOMUtil.byId('addBtn');
                if (addBtn) {
                    DOMUtil.on(addBtn, 'click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        openAddModal();
                        return false;
                    });
                }

                // Modal close button
                const modalCloseBtn = DOMUtil.byId('modalCloseBtn');
                if (modalCloseBtn) {
                    DOMUtil.on(modalCloseBtn, 'click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        closeSatelliteModal();
                        return false;
                    });
                }

                // Save button
                const saveSatelliteBtn = DOMUtil.byId('saveSatelliteBtn');
                if (saveSatelliteBtn) {
                    DOMUtil.on(saveSatelliteBtn, 'click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        saveSatellite();
                        return false;
                    });
                }

                // Cancel button
                const cancelSatelliteBtn = DOMUtil.byId('cancelSatelliteBtn');
                if (cancelSatelliteBtn) {
                    DOMUtil.on(cancelSatelliteBtn, 'click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        closeSatelliteModal();
                        return false;
                    });
                }

                // Modal backdrop click
                const satelliteModal = DOMUtil.byId('satelliteModal');
                if (satelliteModal) {
                    DOMUtil.on(satelliteModal, 'click', (e) => {
                        if (e.target.id === 'satelliteModal') {
                            closeSatelliteModal();
                        }
                    });
                }
            }

            // ============================================================
            // SORT CONTROLS
            // ============================================================

            function updateSortOptions() {
                const sortSelect = DOMUtil.byId('sortSelect');
                if (!sortSelect) return;

                let options = [];

                if (currentTab === 'satellites') {
                    options = [
                        { label: 'Name (A-Z)', value: 'name-asc' },
                        { label: 'Name (Z-A)', value: 'name-desc' },
                        { label: 'NORAD ID ‚Üë', value: 'norad_id-asc' },
                        { label: 'NORAD ID ‚Üì', value: 'norad_id-desc' },
                        { label: 'Status (A-Z)', value: 'status-asc' },
                        { label: 'Launch Date (Newest)', value: 'launch_date-desc' },
                        { label: 'Launch Date (Oldest)', value: 'launch_date-asc' }
                    ];
                } else {
                    options = [
                        { label: 'Name (A-Z)', value: 'name-asc' },
                        { label: 'Name (Z-A)', value: 'name-desc' },
                        { label: 'Type (A-Z)', value: 'type-asc' },
                        { label: 'Type (Z-A)', value: 'type-desc' }
                    ];
                }

                sortSelect.innerHTML = options.map(opt => `<option value="${opt.value}">${opt.label}</option>`).join('');
                currentSort = { column: 'name', direction: 'asc' };
            }

            // ============================================================
            // LIST RENDERING
            // ============================================================

            function renderList() {
                const listContainer = DOMUtil.byId('listContainer');
                if (!listContainer) return;

                let items = [];

                if (currentTab === 'satellites') {
                    items = data.satellites
                        .filter(s => {
                            const matchesSearch = !searchTerm ||
                                s.name.toLowerCase().includes(searchTerm) ||
                                s.norad_id.toString().includes(searchTerm);
                            return matchesSearch;
                        })
                        .map(item => {
                            const sensorCount = data.satellite_sensor_links.filter(l => l.norad_id === item.norad_id).length;
                            return { ...item, sensorCount };
                        });
                } else {
                    items = data.sensors
                        .filter(s => {
                            const matchesSearch = !searchTerm ||
                                s.name.toLowerCase().includes(searchTerm) ||
                                s.type.toLowerCase().includes(searchTerm);
                            return matchesSearch;
                        })
                        .map(item => {
                            const satelliteCount = data.satellite_sensor_links.filter(l => l.sensor_id === item.sensor_id).length;
                            return { ...item, satelliteCount };
                        });
                }

                items.sort((a, b) => {
                    let aVal = a[currentSort.column] ?? '';
                    let bVal = b[currentSort.column] ?? '';

                    if (currentSort.column === 'norad_id') {
                        aVal = parseInt(aVal) || 0;
                        bVal = parseInt(bVal) || 0;
                    }

                    if (currentSort.column === 'launch_date') {
                        aVal = aVal ? new Date(aVal).getTime() : 0;
                        bVal = bVal ? new Date(bVal).getTime() : 0;
                    }

                    if (typeof aVal === 'string') {
                        aVal = aVal.toLowerCase();
                        bVal = bVal.toLowerCase();
                    }

                    if (aVal < bVal) return currentSort.direction === 'asc' ? -1 : 1;
                    if (aVal > bVal) return currentSort.direction === 'asc' ? 1 : -1;
                    return 0;
                });

                if (items.length === 0) {
                    listContainer.innerHTML = '<div class="no-data">No results found</div>';
                    return;
                }

                listContainer.innerHTML = items.map(item => {
                    const key = currentTab === 'satellites' ? 'norad_id' : 'sensor_id';
                    const itemId = item[key];
                    const actualId = item.ID || itemId;
                    const count = currentTab === 'satellites' ? item.sensorCount : item.satelliteCount;
                    const countLabel = currentTab === 'satellites' ? 'sensors' : 'satellites';

                    return `
                        <div class="list-item" data-item-key="${key}" data-item-value="${itemId}" data-item-type="${currentTab}">
                            <div class="list-item-content">
                                <div class="list-item-title">${escapeHtml(item.name)}</div>
                                <div class="list-item-meta">
                                    ${currentTab === 'satellites' ? `${item.orbit_type} ‚Ä¢ ${item.status}` : `${item.type}`}
                                    <span class="sensor-count-badge">${count} ${countLabel}</span>
                                </div>
                            </div>
                            <div class="list-item-actions">
                                <button type="button" class="btn btn-small btn-secondary" data-edit-id="${actualId}">‚úèÔ∏è</button>
                                <button type="button" class="btn btn-small btn-danger" data-delete-id="${actualId}">üóëÔ∏è</button>
                            </div>
                        </div>
                    `;
                }).join('');

                DOMUtil.queryAll('.list-item').forEach(item => {
                    DOMUtil.on(item, 'click', (e) => {
                        if (e.target.closest('.list-item-actions')) return;
                        const key = item.dataset.itemKey;
                        const value = parseInt(item.dataset.itemValue);
                        const type = item.dataset.itemType;
                        selectItem(key, value, type);
                    });

                    const editBtn = item.querySelector('[data-edit-id]');
                    if (editBtn) {
                        DOMUtil.on(editBtn, 'click', (e) => {
                            e.preventDefault();
                            e.stopPropagation();
                            const id = parseInt(editBtn.dataset.editId);
                            editItem(id);
                            return false;
                        });
                    }

                    const deleteBtn = item.querySelector('[data-delete-id]');
                    if (deleteBtn) {
                        DOMUtil.on(deleteBtn, 'click', (e) => {
                            e.preventDefault();
                            e.stopPropagation();
                            const id = parseInt(deleteBtn.dataset.deleteId);
                            deleteItem(id);
                            return false;
                        });
                    }
                });
            }

            // ============================================================
            // SELECTION AND DETAILS
            // ============================================================

            function selectItem(key, value, type) {
                selectedItem = { type, key, value };

                DOMUtil.queryAll('.list-item').forEach(item => DOMUtil.removeClass(item, 'active'));
                const activeItem = DOMUtil.query(`.list-item[data-item-key="${key}"][data-item-value="${value}"]`);
                if (activeItem) DOMUtil.addClass(activeItem, 'active');

                displayDetails();
                displayRelationships();
            }

            function displayDetails() {
                const detailsPanel = DOMUtil.byId('detailsPanel');
                if (!detailsPanel || !selectedItem) return;

                const type = selectedItem.type;
                const value = selectedItem.value;

                let item, html;

                if (type === 'satellites') {
                    item = data.satellites.find(s => s.norad_id === value);
                    if (!item) return;

                    html = `
                        <h2><span class="icon">üõ∞Ô∏è</span>${escapeHtml(item.name)}</h2>
                        <div class="detail-grid">
                            <div class="detail-item">
                                <div class="detail-label">NORAD ID</div>
                                <div class="detail-value">${item.norad_id}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">COSPAR ID</div>
                                <div class="detail-value">${escapeHtml(item.cospar_id || '-')}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Status</div>
                                <div class="detail-value">${escapeHtml(item.status)}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Orbit Type</div>
                                <div class="detail-value">${escapeHtml(item.orbit_type)}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Mission</div>
                                <div class="detail-value">${escapeHtml(item.mission || '-')}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Launch Date</div>
                                <div class="detail-value">${escapeHtml(item.launch_date || '-')}</div>
                            </div>
                        </div>
                    `;
                } else {
                    item = data.sensors.find(s => s.sensor_id === value);
                    if (!item) return;

                    html = `
                        <h2><span class="icon">üì°</span>${escapeHtml(item.name)}</h2>
                        <div class="detail-grid">
                            <div class="detail-item">
                                <div class="detail-label">Sensor Type</div>
                                <div class="detail-value">${escapeHtml(item.type)}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Number of Bands</div>
                                <div class="detail-value">${item.bands || 'N/A'}</div>
                            </div>
                        </div>
                        <div class="section-title">Specifications</div>
                        <div class="detail-grid">
                            <div class="detail-item">
                                <div class="detail-label">Resolution (m)</div>
                                <div class="detail-value">${item.resolution_min} ‚Äì ${item.resolution_max}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Swath Width (km)</div>
                                <div class="detail-value">${item.swath_min} ‚Äì ${item.swath_max}</div>
                            </div>
                        </div>
                        <div class="section-title">Description</div>
                        <div class="detail-item">
                            <div class="detail-value">${escapeHtml(item.description)}</div>
                        </div>
                    `;
                }

                detailsPanel.innerHTML = html;
            }

            function clearDetails() {
                const detailsPanel = DOMUtil.byId('detailsPanel');
                const relationshipsList = DOMUtil.byId('relationshipsList');

                if (detailsPanel) {
                    detailsPanel.innerHTML = `
                        <div class="empty-state">
                            <div class="icon">üìä</div>
                            <p>Select a satellite or sensor to view details</p>
                        </div>
                    `;
                }

                if (relationshipsList) {
                    relationshipsList.innerHTML = '<div class="no-data">No selection</div>';
                }
            }

            // ============================================================
            // RELATIONSHIPS
            // ============================================================

            function displayRelationships() {
                const relationshipsList = DOMUtil.byId('relationshipsList');
                if (!relationshipsList || !selectedItem) return;

                const type = selectedItem.type;
                const value = selectedItem.value;

                let relationships = [];

                if (type === 'satellites') {
                    const satLinks = data.satellite_sensor_links.filter(link => link.norad_id === value);
                    const seen = new Set();

                    relationships = satLinks
                        .map(link => data.sensors.find(s => s.sensor_id === link.sensor_id))
                        .filter(sensor => sensor && !seen.has(sensor.sensor_id) && seen.add(sensor.sensor_id))
                        .map(sensor => ({
                            name: sensor.name,
                            type: sensor.type,
                            id: sensor.sensor_id,
                            relType: 'sensor',
                            clickType: 'sensors'
                        }));
                } else {
                    const sensorLinks = data.satellite_sensor_links.filter(link => link.sensor_id === value);
                    const seen = new Set();

                    relationships = sensorLinks
                        .map(link => data.satellites.find(s => s.norad_id === link.norad_id))
                        .filter(sat => sat && !seen.has(sat.norad_id) && seen.add(sat.norad_id))
                        .map(sat => ({
                            name: sat.name,
                            type: `${sat.orbit_type} (${sat.norad_id})`,
                            id: sat.norad_id,
                            relType: 'satellite',
                            clickType: 'satellites'
                        }));
                }

                if (relationships.length === 0) {
                    relationshipsList.innerHTML = '<div class="no-data">No relationships found</div>';
                    return;
                }

                const label = type === 'satellites' ? 'sensors' : 'satellites';

                relationshipsList.innerHTML = `<div class="relationships-count">${relationships.length} linked ${label}</div>` +
                    relationships.map(rel => `
                        <div class="relationship-item ${rel.relType === 'sensor' ? 'sensor-type' : ''}" data-switch-tab="${rel.clickType}" data-switch-id="${rel.id}">
                            <div class="rel-title">${escapeHtml(rel.name)}</div>
                            <div class="rel-type">${escapeHtml(rel.type)}</div>
                        </div>
                    `).join('');

                DOMUtil.queryAll('.relationship-item').forEach(item => {
                    DOMUtil.on(item, 'click', (e) => {
                        e.preventDefault();
                        const tabName = item.dataset.switchTab;
                        const itemId = parseInt(item.dataset.switchId);
                        switchAndSelect(tabName, itemId);
                    });
                });
            }

            // ============================================================
            // NAVIGATION
            // ============================================================

            function switchAndSelect(tabName, itemId) {
                DOMUtil.queryAll('.tab').forEach(t => DOMUtil.removeClass(t, 'active'));
                const targetTab = DOMUtil.query(`[data-tab="${tabName}"]`);
                if (targetTab) DOMUtil.addClass(targetTab, 'active');
                currentTab = tabName;

                updateSortOptions();
                renderList();

                setTimeout(() => {
                    const itemToSelect = currentTab === 'satellites'
                        ? data.satellites.find(s => s.norad_id === itemId)
                        : data.sensors.find(s => s.sensor_id === itemId);

                    if (itemToSelect) {
                        const key = currentTab === 'satellites' ? 'norad_id' : 'sensor_id';
                        selectItem(key, itemId, currentTab);
                    }
                }, 0);
            }

            // ============================================================
            // CRUD OPERATIONS
            // ============================================================

            function openAddModal() {
                if (currentTab === 'satellites') {
                    editingId = null;
                    const satelliteModalTitle = DOMUtil.byId('satelliteModalTitle');
                    const satelliteForm = DOMUtil.byId('satelliteForm');
                    const satelliteModal = DOMUtil.byId('satelliteModal');

                    if (satelliteModalTitle) satelliteModalTitle.textContent = 'Add Satellite';
                    if (satelliteForm) satelliteForm.reset();
                    clearSatelliteForm();

                    if (satelliteModal) DOMUtil.addClass(satelliteModal, 'active');
                } else {
                    showAlert('Sensor CRUD coming soon!', 'info');
                }
            }

            function closeSatelliteModal() {
                const satelliteModal = DOMUtil.byId('satelliteModal');
                const satelliteForm = DOMUtil.byId('satelliteForm');

                if (satelliteModal) DOMUtil.removeClass(satelliteModal, 'active');
                if (satelliteForm) satelliteForm.reset();

                clearSatelliteForm();
                editingId = null;
            }

            function clearSatelliteForm() {
                const textFields = ['sat-name', 'sat-norad', 'sat-cospar', 'sat-mission', 'sat-launch', 'sat-sensors'];
                textFields.forEach(id => {
                    const element = DOMUtil.byId(id);
                    if (element) element.value = '';
                });

                const satStatus = DOMUtil.byId('sat-status');
                if (satStatus) satStatus.value = 'Operational';

                const satOrbit = DOMUtil.byId('sat-orbit');
                if (satOrbit) satOrbit.value = '';

                DOMUtil.queryAll('.validation-error').forEach(el => el.textContent = '');
                DOMUtil.queryAll('.form-group input, .form-group textarea, .form-group select').forEach(el => {
                    DOMUtil.removeClass(el, 'error');
                });
            }

            function editItem(id) {
                if (currentTab === 'satellites') {
                    const sat = data.satellites.find(s => s.ID === id || s.norad_id === id);

                    if (!sat) {
                        showAlert('Satellite not found', 'error');
                        return;
                    }

                    editingId = sat.ID;
                    const satelliteModalTitle = DOMUtil.byId('satelliteModalTitle');
                    const satelliteModal = DOMUtil.byId('satelliteModal');

                    if (satelliteModalTitle) satelliteModalTitle.textContent = 'Edit: ' + sat.name;

                    const fields = {
                        'sat-name': sat.name,
                        'sat-norad': sat.norad_id,
                        'sat-cospar': sat.cospar_id || '',
                        'sat-mission': sat.mission || '',
                        'sat-status': sat.status || 'Operational',
                        'sat-orbit': sat.orbit_type || '',
                        'sat-launch': sat.launch_date || '',
                        'sat-sensors': sat.sensor_names || ''
                    };

                    Object.entries(fields).forEach(([id, value]) => {
                        const element = DOMUtil.byId(id);
                        if (element) element.value = value;
                    });

                    if (satelliteModal) DOMUtil.addClass(satelliteModal, 'active');
                } else {
                    showAlert('Sensor editing coming soon!', 'info');
                }
            }

            function saveSatellite() {
                if (isLoading) {
                    showAlert('Please wait...', 'info');
                    return;
                }

                const satelliteData = {
                    name: (DOMUtil.byId('sat-name')?.value || '').trim(),
                    norad_id: (DOMUtil.byId('sat-norad')?.value || '').trim(),
                    cospar_id: (DOMUtil.byId('sat-cospar')?.value || '').trim(),
                    mission: (DOMUtil.byId('sat-mission')?.value || '').trim(),
                    status: DOMUtil.byId('sat-status')?.value || 'Operational',
                    orbit_type: DOMUtil.byId('sat-orbit')?.value || '',
                    launch_date: DOMUtil.byId('sat-launch')?.value || '',
                    sensor_names: (DOMUtil.byId('sat-sensors')?.value || '').trim()
                };

                let hasError = false;
                const errorName = DOMUtil.byId('error-sat-name');
                const errorNorad = DOMUtil.byId('error-sat-norad');

                if (!satelliteData.name) {
                    if (errorName) errorName.textContent = 'Name is required';
                    hasError = true;
                } else {
                    if (errorName) errorName.textContent = '';
                }

                if (!satelliteData.norad_id) {
                    if (errorNorad) errorNorad.textContent = 'NORAD ID is required';
                    hasError = true;
                } else if (!/^\d+$/.test(satelliteData.norad_id)) {
                    if (errorNorad) errorNorad.textContent = 'NORAD ID must be numeric';
                    hasError = true;
                } else {
                    if (errorNorad) errorNorad.textContent = '';
                }

                if (hasError) {
                    showAlert('Please fix validation errors', 'error');
                    return;
                }

                if (editingId) {
                    const index = data.satellites.findIndex(s => s.ID === editingId);
                    if (index >= 0) {
                        data.satellites[index] = { ...data.satellites[index], ...satelliteData };
                    }
                } else {
                    data.satellites.push({
                        ID: Date.now(),
                        norad_id: parseInt(satelliteData.norad_id),
                        ...satelliteData
                    });
                }

                buildSatelliteSensorLinksFromNames();
                closeSatelliteModal();
                renderList();
                showAlert('Satellite saved!', 'success');
            }

            function deleteItem(id) {
                if (!window.confirm('Are you sure you want to delete this item?')) return;

                if (currentTab === 'satellites') {
                    data.satellites = data.satellites.filter(s => s.ID !== id);
                    buildSatelliteSensorLinksFromNames();
                    selectedItem = null;
                    renderList();
                    clearDetails();
                    showAlert('Satellite deleted!', 'success');
                } else {
                    showAlert('Sensor deletion coming soon!', 'info');
                }
            }

            // ============================================================
            // UTILITIES
            // ============================================================

            function escapeHtml(text) {
                if (!text) return '';
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            function showAlert(message, type = 'info') {
                const container = DOMUtil.byId('alertContainer');
                if (!container) return;

                const alert = DOMUtil.create('div', {
                    class: `alert alert-${type}`,
                    text: message
                });
                container.appendChild(alert);
                setTimeout(() => alert.remove(), 5000);
            }

            console.log('‚úÖ Satellite Sensor Explorer v5.8.3 (Vanilla JS - Isolated) loaded and ready');
        })();
    </script>
</body>
</html>
